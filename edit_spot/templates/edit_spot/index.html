{% extends "base.html" %}

{% block title %}
    Mitopo.de
{% endblock %}

{% block extra_assets %}

    {% load leaflet_tags %}
    {% load geojson_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

{% endblock %}

{% block content %}

    <script type="text/javascript">

        function map_init(map, options) {
            map.zoomControl.setPosition("topright");

            var markerArray = [];

            {% for spot in spot_listing %}
                var coord = L.latLng({{ spot.geom.coordinates }});
                var newcoord = L.latLng(coord.lng, coord.lat);
                var mc = new L.marker(newcoord);
                mc.bindPopup("<a href={% url "spot_detail" spot_id=spot.id %}>{{spot.name}}</a>");
                markerArray.push(mc);
            {% endfor %}

            var group = L.featureGroup(markerArray);

            map.options.maxZoom = 17;
            markers = new L.MarkerClusterGroup();
            markers.addLayer(group);
            map.addLayer(markers);

            if (markerArray.length > 1) {
                map.fitBounds(group.getBounds());
            } else {
                map.setView(markerArray[0].getLatLng(), 10);
            }

        }

    </script>

    {% leaflet_map "spots" callback="window.map_init" %}

{% endblock %}

{% block mapobjects_info %}

    Number of Spots: {{ spot_listing|length }} <br>

    <form action="{% url 'add_spot' %}">
        <input id="add_spot_button" type="submit" value="Add new spot">
    </form>

    <h2>Edit Spots:</h2>
    <ul>
        {% for spot in spot_listing %}
            <li>
                <a class="spot_entry" href="{% url "edit_spot" spot_id=spot.pk %} ">{{ spot.name }}</a>
            </li>
        {% endfor %}
    </ul>
{% endblock %}
