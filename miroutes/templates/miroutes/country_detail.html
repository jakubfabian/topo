{% extends "base.html" %}

{% block title %}
    Mitopo.de - Country Detail
{% endblock %}

{% block extra_assets %}

    {% load leaflet_tags %}
    {% load geojson_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

{% endblock %}

{% block content %}

    <br><br>
    You're looking at Country selection {{ country.name }}

    {% if spotlist %}

        <script type="text/javascript">

            function map_init(map, options) {

                var markerArray = [];

                {% for spot in spotlist %}
                    var coord = L.latLng({{ spot.geom.coordinates }});
                    var newcoord = L.latLng(coord.lng, coord.lat);
                    var mc = new L.marker(newcoord);
                    mc.bindPopup("<a href={% url "spot_detail" spot_id=spot.pk %}>{{ spot.name }}</a>");
                    markerArray.push(mc);
                {% endfor %}

                var group = L.featureGroup(markerArray);

                map.options.maxZoom = 15;
                markers = new L.MarkerClusterGroup();
                markers.addLayer(group);
                map.addLayer(markers);

                if (markerArray.length > 1) {
                    map.fitBounds(group.getBounds());
                } else {
                    map.setView(markerArray[0].getLatLng(), 12);
                }
            }
        </script>

        {% leaflet_map "spots" callback="window.map_init" %}

        {% block mapobjects_info %}

            In {{ country.name }} there are following areas:<br><br>

            {% for area in country_area_list %}
                <li><a href={% url "area_detail" area_id=area.pk %}> {{ area.name }}</a></li>
            {% endfor %}

            <br>
            <br>


            Spots:
            {% for spot in spotlist %}
                <li>
                    <a href={% url "spot_detail" spot_id=spot.pk %}> {{ spot.name }} {{ spot.geom.coordinates }}</a>
                </li>
            {% endfor %}
            </ul>
        {% endblock %}

    {% else %}
        <p>Currently no areas are available in {{ country.name }}</p>
    {% endif %}

{% endblock %}
