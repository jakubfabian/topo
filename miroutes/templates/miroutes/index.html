{% extends "base.html" %}

{% block title %} 
	<title>Mitopo.de</title>
{% endblock %}

{% block extra_assets %}

<style>
.leaflet-container {  /* all maps */
    width:  100%;
    height: 600px;
}
</style>

{% load leaflet_tags %}
{% load geojson_tags %}
{% leaflet_js %}
{% leaflet_css %}

{% endblock %} 

{% block content %}
{% if country_listing %}
    <script type="text/javascript">

      function map_init(map, options) {

        var markerArray = [];

       {% for spot in spot_listing %}
            var coord = L.latLng({{ spot.geom.coordinates }});
            var newcoord = L.latLng(coord.lng, coord.lat);
            var mc = new L.marker(newcoord);
            mc.bindPopup("<a href={% url "spot_detail" spot_id=spot.id %}>{{spot.spot_name}}</a>");
            markerArray.push(mc);
        {% endfor %}

        var group = L.featureGroup(markerArray).addTo(map);
        if (markerArray.length > 1){
                map.fitBounds(group.getBounds());
        } else {
            map.setView(markerArray[0].getLatLng(), 10);
        }	

      }

    </script>

    {% leaflet_map "spots" callback="window.map_init" %}



    <ul>
    {% for country in country_listing %}
    <li><a href="{% url "country_detail" country_id=country.id%}">{{ country.country_name }}</a></li>
    {% endfor %}
    </ul>
{% else %}
    <p>No countries are available.</p>
{% endif %}





<b>Statistics:</b>
<br><br>
Countries: {{ country_listing|length }} <br>
Areas: {{ area_listing|length }} <br>
Spots: {{ spot_listing|length }} <br>
Walls: {{ wall_listing|length }} <br>
Routes: {{ route_listing|length }} <br>
{% endblock %}
