{% extends "base.html" %}

{% block title %}
    Mitopo.de
{% endblock %}

{% block extra_assets %}

    {% load leaflet_tags %}
    {% load geojson_tags %}
    {% leaflet_js %}
    {% leaflet_css %}



    <script type="text/javascript">

        function map_init(map, options) {

            map.zoomControl.setPosition("topright");
            var markerArray = [];

            {% for spot in spot_listing %}
                var coord = L.latLng({{ spot.geom.coordinates }});
                var newcoord = L.latLng(coord.lng, coord.lat);
                var mc = new L.marker(newcoord);
                mc.bindPopup("<a href={% url "spot_detail" spot_id=spot.id %}>{{spot.name}}</a>");
                markerArray.push(mc);
            {% endfor %}


            map.options.maxZoom = 15;

            var group = L.featureGroup(markerArray);
            markers = new L.MarkerClusterGroup();
            markers.addLayer(group);
            map.addLayer(markers);

            if (markerArray.length === 0) {
                munich = new L.marker([48.137154, 11.576124]);
                map.setView(munich.getLatLng(), 10);
            } else if (markerArray.length === 1) {
                map.setView(markerArray[0].getLatLng(), 10);
            } else {
                map.fitBounds(group.getBounds());
            }
        }

    </script>
{% endblock %}

{% block content %}
    {% leaflet_map "spots_map" callback="window.map_init" %}
{% endblock %}

{% block mapobjects_info %}

    Spots: {{ spot_listing|length }} <br>
    Walls: {{ wall_listing|length }} <br>
    Routes: {{ route_listing|length }} <br>

    <h2>Spots</h2>
    <ul>
        {% for spot in spot_listing %}
            <li>
                <a class="spot_entry" href="{% url "spot_detail" spot_id=spot.pk %} ">{{ spot.name }}</a>
            </li>
        {% endfor %}
    </ul>

    <h2>Walls</h2>

    <ul>
        {% for wall in wall_listing %}
            <li><a href="{% url "wall_detail" wall_id=wall.pk %}">{{ wall.name }}</a></li>
        {% endfor %}
    </ul>

{% endblock %}
