{% extends "base.html" %}
{% load staticfiles %}

{% block title %}
    Mitopo.de - Spot Detail
{% endblock %}

{% block extra_assets %}

    {% load leaflet_tags %}
    {% load geojson_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

    <script type="text/javascript">

        function map_init(map, options) {
            map.zoomControl.setPosition("topright");

            var markerArray = [];

            {% for wall in spot_wall_list %}
                var coord = L.latLng({{ wall.geom.coordinates }});
                var newcoord = L.latLng(coord.lng, coord.lat);
                var mc = new L.marker(newcoord);
                mc.bindPopup("<a href={% url "wall_detail" wall_id=wall.pk%}>{{ wall.name }}</a>");
                markerArray.push(mc);
            {% endfor %}

            var group = L.featureGroup(markerArray);

            map.options.maxZoom = 15;
            markers = new L.MarkerClusterGroup();
            markers.addLayer(group);

            {% if spot.parking_geom %}
            var editParkingIcon = L.icon({
                iconUrl: '{% static "edit_spot/img/edit_parking_icon.png" %}',
                iconSize: [30, 30], // size of the icon
                iconAnchor: [15, 15], // point of the icon which will correspond to marker's location
                popupAnchor: [1, -34] // point from which the popup should open relative to the iconAnchor
            });

            var editing_Parking = {{ spot|geojsonfeature:":parking_geom"|safe }};
            var editParkingLayer = L.geoJson(editing_Parking, {
                pointToLayer: function (feature, latlng) {
                    park_marker = L.marker(latlng, {icon: editParkingIcon});
                    return park_marker;
                }
            });

            markers.addLayer(editParkingLayer);
            {% endif %}
            
            map.addLayer(markers);
            if (markerArray.length > 1) {
                map.fitBounds(group.getBounds());
            } else {
                map.setView(markerArray[0].getLatLng(), 15);
            }
        }
    </script>


{% endblock %}

{% block content %}
    {% leaflet_map "spots" callback="window.map_init" %}

{% endblock %}

{% block mapobjects_info %}
    {% if spot_wall_list %}

        Show_inactive ::
        {% if request.session.show_inactive == True %}
            <a href="{% url 'toggle_show_inactive' %}?from={{ request.path|urlencode }}">true</a>
        {% else %}
            <a href="{% url 'toggle_show_inactive' %}?from={{ request.path|urlencode }}">false</a>
        {% endif %}
        <br><br>

        You're looking at spot {{ spot.name }}.
        <!-- if you are a spot manager -->

        <br><br>


        In {{ spot.name }} there are following walls:<br><br>

        <ul>
            {% for wall in spot_wall_list %}
                <li><a href="{% url "wall_detail" wall_id=wall.pk %}"> {{ wall.name }}
                    :: {{ wall.geom.coordinates }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Currently no walls are available in {{ spot.name }}</p>
    {% endif %}

    {% if perms.miroutes.change_spot %}
    <a class="btn btn-default" href="{% url 'edit_spot' spot_id=spot.id %}">Edit Spot</a>
    {% endif %}

{% endblock %}















